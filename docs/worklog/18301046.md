# Work Logs

> Will you join in our crusade?  
Who will be strong and stand with me?  
Beyond the barricade  
Is there a world you long to see?  
Then join in the fight  
That will give you the right to be free  

> Do you hear the people sing?  
Singing a song of angry men?  
It is the music of a people  
Who will not be slaves again  

> When the beating of your heart  
Echoes the beating of the drums  
There is a life about to start  
When tomorrow comes  

It's time to destory the damn GFW.

Without GFW, I could save more than half of time&works.

## 29 Jun 2020

### Init Kubernetes

 - [x] Shell installation script
 - [ ] Finish installation on every node

During this process, we met a serious network authority problem. BJTU's Authority System redirect all HTTP requests to its authority gateway.

### Make Network Great Again

GFW has a little influence in IPv6, so the first idea is transferring all public IPv4 requests into IPv6 using NAT64/DNS64.

#### Systemd-resolved

In Ubuntu 18.04, DNS service is handled by Systemd-resolved. It seems very useful in document. Just in document.In fact, it's very terrible, After manually config Public DNS64 Server, the DNS server which is provided by DHCPv4 will still be used.

Set disable dns on ens3 by `netplan` doesn't works too.

So finally, I disabled systemd-resolved, manually manage all DNS setting.

#### DNS64

Well, Google's service need to build your own NAT64 server in LAN, obviously I can't use it simply.

After change DNS, I make default IPv4 route prefer to loopback interface to block all v4 request.

| Provider                   | Address                  |
| -------------------------- | ------------------------ |
| A10 Networks               | `2001:67c:27e4:15::6411` |
| PaloAlto Networks Firewall | `2001:67c:27e4::64`      |
| Jool                       | `2001:67c:27e4:15::64`   |
| Cisco ASR1000              | `2001:67c:27e4::60`      |

I tried those servers above, and the bad news is when they met a dual stack domain, It will do nothing to raw response. And google's package server is also banned in IPv6. It seems that I need to build my own NAT64 server or install vpn on those vps.

## 30 Jun 2020

### Openvpn

Today i'll try build my own NAT64 server at first. I will install vpn if my NAT64 doesn't work.

Still use NAT64, but changed package source into tuna mirror, I make a progess in installing kubernetes. However, dual stack registy like gcr.io is still a problem.

Finally, I installed openvpn on every node, redirect all requests to Los Angles over IPV6.

## 1 Jul 2020

### Network Plugin

It's easy now to startup a single node. But when it comes to cluster, a larger problem appears, every network department can't work at all, they can't communite each other, so the startup process hangs forever.

## 2 Jul 2020

### Still Network Plugin

## 3 Jul 2020

### Four legs good, two legs bad

Microk8s said it is **Zero-Ops**, I think i need have a try.

## 4 Jul 2020

### Helm

### Jenkins

## 5 Jul 2020

### CI

## 6 Jul 2020

### Continuous Build & Test

## 7 Jul 2020

### Kubeflow

## 8 Jul 2020

### Build Image in k8s -- Kaniko 

## 9 Jul 2020

### [Buildkit](https://github.com/moby/buildkit)

BuildKit is another tool for build image without docker, however, it latest version has a bug which causes a problem in pushing to plainHTTP registry.

This bug was introduced on 6 Mar 2020 by commit [2c3cf11fde5910839092199ef99389401a545625](https://github.com/moby/buildkit/commit/2c3cf11fde5910839092199ef99389401a545625#diff-90c6ef971c28bb3079af647d9a3c4c09), in the modification of `util/push/push.go`. The author forget a parameter `insecure`. Because he widely changed program's logic across lots of file, it is not easy to fix it quickly.

So I downgrade its version.

### Kubeflow

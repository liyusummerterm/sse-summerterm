# 总体设计

## 	1.1 需求设计

​	计算时间序列问题时，ARIMA模型准确性较差，根据了解，时序列预测使用循环神经网络（RNN）较好，可以更好找出时序列上的前后关联。本组选用了lstm（Long Short Term Memory networks），相比与stm，lstm更适用于解决长依赖问题。但是经测试，单纯由lstm预测出的效果并不理想，均方误差较高，所以选择使用经验模态分解( empirical mode decomposition，下称EMD)对天气数据进行处理。EMD原用于将信号分解不同频率特性。通过特征时间尺度来识别天气数据中所内含的所有固有振动模态（Instrinsic Mode Function, 下称IMF） 。在这一过程中，特征时间尺度及IMF的定义都具有一定的经验性和近似性。与其他处理方法相比，EMD方法是直观的、间接的、后验的、自适应的，其分解所用的特征时间尺度是源自于原始数据变化趋势的。本组使用EMD寻找到7个IMF以及一个RES（Residue, 残余函数，本处为天气数据中的噪音），将其传入lstm进行处理。

## 	1.2 运行环境

​	本算法实在win 10 64位系统运行，使用 tensorflow 2.2.0、 pands、 numpy等库，并安装了Cuda 使用GPU运行训练模型。

## 	1.3 基本算法操作流程

* 步骤1：根据传入的城市，读取该城市已处理好的天气数据
* 步骤2：若有可加载的模型，则加载并进行步骤3；若没有则开始训练模型，根据过去20天数据预测未来7天数据，epoch设为50
* 步骤3：根据传入的预测开始日期，依次加载“TMAX”、“TAVG”、“TMIN”、“PRCP”数据并开始预测
* 步骤4：将预测结果以nparray格式输出

# 基本算法

## EMD 算法：

输入原始信号（本项目中为天气数据）Series；输出固有模态函数IMF1，IMF2，…，IMF7和噪声Res。

- step1：找出Series中的所有局部极大值和局部极小值。
- step2：利用三次样条插值函数，分别将局部极大值串联成Series的上包络线，局部极小值串联成下包络线。
- step3：求出上下包络线的平均值m1,。
- step4：令H1 = Series - m1，检查h1是否满足IMF条件，如未满足则用H1替代原始信号Series，回到step1，直到hk满足IMF条件。
- step5：将Hk作为IMF1，令Res1 = Series - IMF1，判断r是否单调，如不单调则以R1作为原始信号回到step1，直到Res单调或IMF数量达到设定上限值，获得趋势项。

## LSTM算法：

给模型设置了两个LSTM层和一个Dense（全连接）层，设置了imput_dim为(None,None,8)。将预测参考天数 look_back 设为20，预测天数 forward_days 设为7，epochs设为50，batch_size 设为512。算法中首先使用1980-2020的数据训练模型，设置了checkpoint使得训练即使在终于停止也不会丢失过多内容，训练好的模型存储于根目录下model文件夹中相应目录下。

训练数据由读取的数据去掉目标预测日期以后的数据组成，进行归一化后创建模型i并开始训练。如果已有模型则加载。选取指定日期前 look_back 天的数据进行预测，将预测完结果以nparray格式输出。